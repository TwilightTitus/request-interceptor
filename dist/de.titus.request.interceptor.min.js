!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";const o={},r={interceptors:[],doIntercept:function(t,e){let n=function(t,e){return new Promise(function(){let e=o[t.server];return void 0===e&&(e=[],this.interceptors.forEach(function(n){n.doAccept(t)&&e.push(n)}),o[t.server]=e),chainM})}(t),r=[];return n.forEach(function(n){r.push(n.doHandle(t,e))}),Promise.all(r)},addInterceptor:function(t){if(1!=arguments.length&&"object"!=typeof t)throw new Error("function required an interceptor");if("function"!=typeof t.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof t.doHandle)throw new Error('The interceptor required a "doHandle" function!');return this.interceptors.push(t)}};e.a=r},function(t,e,n){"use strict";e.a={URLSPLITTER:/^((([^:\/]*:)?\/\/)?([^:\/]*)(\:([0-9]*))?)(\/.*)?$/}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";var o=function(t){this.rawToken=t;let e=t.split(".");if(3!=e.length)throw new Error('No valid json web token! - "'+t+'"');this.header=JSON.parse(atob(e[0])),this.body=JSON.parse(atob(e[1])),this.signature=e[2]};const r=function(t){this.setup=t,this.setup.refresh=this.setup.refresh||{interval:"always"},this.jwt,this.useFetch="function"==typeof window.fetch};r.DEFAULT={MIN_REFRESH_INTERVALL_TIME:6e5},r.prototype.doAccept=function(t){let e=typeof this.setup.condition;if("function"===e)return this.setup.condition(t);if("string"===e)return this.setup.condition==t.server;if(this.setup.condition instanceof Array)for(let e=0;e<this.setup.condition.length;e++)if(this.setup.condition[e]==t.server)return!0;return!1},r.prototype.doHandle=function(t,e,n){let o=e instanceof XMLHttpRequest,i=r.prototype[o?"appendJwtXHR":"appendJwt"].bind(this,e,n);if(this.jwt&&"always"!==this.setup.refresh.interval)return i(this.jwt);this.__loadToken(n)},r.prototype.__loadToken=function(t){return this.useFetch?this.__loadTokenFetch(t):this.__loadTokenByXHR(t)},r.prototype.__loadTokenFetch=function(t){return fetch(this.setup.login.url,{method:this.setup.login.method||"get"}).then(function(t){return t.json()}).then(r.prototype.__extractToken.bind(this)).then(t||function(){})},r.prototype.__loadTokenByXHR=function(t){let e=new XMLHttpRequest,n=r.prototype.__extractToken.bind(this);return e.onreadystatechange=function(){4==e.readyState&&(n(JSON.parse(this.response)),t&&t(this.jwt))},e.open(this.setup.login.method||"get",this.setup.login.url,!this.setup.login.sync),e.send()},r.prototype.__extractToken=function(t){if(this.jwt=new o(t[this.setup.login.response.valueSelector]),"always"!==this.setup.refreshInterval){let t=this.setup.refresh.interval||r.DEFAULT.MIN_REFRESH_INTERVALL_TIME;if("number"==typeof this.jwt.header.iat&&"number"==typeof this.jwt.header.exp){let e=this.jwt.header.exp-this.jwt.header.iat;t=e>0?e:this.jwt.header.exp}else if("number"==typeof this.jwt.header.exp){let e=this.jwt.header.exp-Date.now();t=e>0?e:this.jwt.header.exp}t=t>r.DEFAULT.MIN_REFRESH_INTERVALL_TIME?t:r.DEFAULT.MIN_REFRESH_INTERVALL_TIME,setTimeout(r.prototype.__loadToken.bind(this),t)}return this.jwt},r.prototype.appendJwt=function(t,e,n){return t.headers=t.header||{},t.headers.Authorization="Bearer "+n.rawToken,"function"==typeof e?e():void 0},r.prototype.appendJwtXHR=function(t,e,n){return t.setRequestHeader("Authorization","Bearer "+n.rawToken),"function"==typeof e?e():void 0};const i={JsonWebToken:o,JWTInterceptor:r};e.a=i},function(t,e,n){"use strict";n.r(e);n(5)},function(t,e,n){"use strict";(function(t){n(6),n(7);var e,o=n(0),r=n(3);(e=window||t||{}).de=e.de||{},e.de.titus=e.de.titus||{},e.de.titus.request=e.de.titus.request||{},e.de.titus.request.interceptor={VERSION:"1.0.0-beta2",Manager:o.a,interceptors:r.a},e.RequestInterceptManager=o.a}).call(this,n(2))},function(t,e,n){"use strict";var o=n(0),r=n(1);if("undefined"!=typeof XMLHttpRequest){const t=XMLHttpRequest.prototype.open,e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(){let e=r.a.URLSPLITTER.exec(arguments[1]);this.__interceptorRequestData={method:arguments[0],url:arguments[1],server:e[1],protocol:function(t){return void 0===t[2]||"//"==t[3]?document.location.protocol||"http:":t[3]}.call(null,e),hostname:e[4]||document.location.hostname,port:e[6],query:e[7],async:"boolean"!=typeof arguments[2]||arguments[2]},t.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){return o.a.doIntercept(this.__interceptorRequestData,this).then(function(){return e.bind(this,arguments)}).catch(function(t){throw t}),this}}},function(t,e,n){"use strict";(function(t){var e=n(0),o=n(1);!function(t){if("function"==typeof t.fetch){const n=t.fetch;t.fetch=function(t,r){let i=r||{},s=o.a.URLSPLITTER.exec(t),u={method:i.method||"GET",url:t,server:s[1],protocol:function(t){return void 0===t[2]||"//"==t[3]?document.location.protocol||"http:":t[3]}.call(null,s),hostname:s[4]||document.location.hostname,port:s[6],query:s[7],async:!0};return e.a.doIntercept(u,i).then(function(){return n.bind(this,t,i)}).catch(function(t){throw t})}}}(window||t||{})}).call(this,n(2))}]);
//# sourceMappingURL=de.titus.request.interceptor.min.js.map